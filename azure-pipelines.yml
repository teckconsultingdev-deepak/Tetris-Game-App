
# Build and push Docker image to Azure Container Registry (ACR)
# Using Self-hosted Azure DevOps Linux Agent

trigger:
- main

pool:
  name: Newpool   # âœ… UPDATED: self-hosted agent pool

variables:
  dockerRegistryServiceConnection: '3944071b-1303-4003-ac55-a717adc5d1a8'
  imageRepository: 'tetrisgameapp'
  dockerfilePath: '$(Build.SourcesDirectory)/Dockerfile'
  tag: '$(Build.BuildId)'

steps:
- checkout: self

# (Optional but recommended) Verify Docker on agent
- script: |
    docker --version
    docker info
  displayName: 'Verify Docker installation'

- task: Docker@2
  displayName: Build and push Docker image to ACR
  inputs:
    command: buildAndPush
    repository: $(imageRepository)
    dockerfile: $(dockerfilePath)
    containerRegistry: $(dockerRegistryServiceConnection)
    tags: |
      $(tag)
